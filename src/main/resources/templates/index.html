<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="ISO-8859-1" />
<title>Pubmine - Lucene</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.2.10/semantic.min.css" />
<script src="https://cdn.jsdelivr.net/semantic-ui/2.2.10/semantic.min.js"></script>


<script src="/css/jquery.bootpag.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>

</head>
<body>
	<div class="ui stackable menu">
		<div class="item">
			<img style="height: 30px; width: 30px;"
				th:src="@{https://semantic-ui.com/images/logo.png}" />
		</div>
		<a href="#" class="item" id="thymeleaf">Pubmine</a>
	</div>
	
	<div class="ui container-fluid">
		<div class="ui fluid icon input focus">
			<input type="text" placeholder="Search here..." id="txtSearch"/> <i
				class="search icon"></i>
		</div>
		<table class="ui padded table">
			<thead>
				<tr>
					<th>Pmid</th>
					<th>Sentence</th>
					<th>Sentence Order</th>
					<th>Abstract Text Order</th>
				</tr>
			</thead>
			<tbody></tbody>			
			<tfoot>
				 <tr>
				 	<th colspan="5">
				      <!-- <div class="ui small right floated pagination menu">
				        <a class="icon item" title="First"><i class="left long arrow icon"></i></a>
				        <a class="item">Previous</a>
				        <a class="item active">1</a>
				        <a class="item">2</a>
				        <a class="item">3</a>
				        <a class="item">Next</a>
				        <a class="icon item" title="Last"><i class="right long arrow icon"></i></a>
				      </div> -->				      
				      <div id="pagination" style="float:right"></div>
				    </th>
				  </tr>
			</tfoot>
		</table>
	</div>
	<script>
		(function(){
			
			var $Pagination = $('#pagination');
			
			var filter = {
				page: 1,
				limit: 10,
				query: ''	
			};
			
			//TODO:
			$('#txtSearch').on('keypress', function(e){
				if(e.keyCode == 13){
					filter.page = 1;
					filter.query = $('#txtSearch').val();
					searchSentence(filter);
				}
			});
			
			//TODO:
			function searchSentence(filter){
				$.ajax({
					url: '/pubmine/v1/sentence',
					data: filter,
					method: 'GET',
					success: function(data){
						console.log(data);
						renderSentence(data.data);
						renderPagination(data.pagable);
					},
					error: function(error){
						console.log(error);
					}
				});
			}
			
			//TODO:
			$Pagination.on("page", function(event, num){
				filter.page = num;
				searchSentence(filter);
	        });
			
			//TODO: 
			function renderPagination(paging){
		        $('#pagination').bootpag({
		        	maxVisible:10,
		        	page: paging.page,
		            total: paging.totalPages,
		            firstLastUse: true,
		            first: '←',
		            last: '→',
		        });
			}
			
			//TODO:
			function renderSentence(sentences){
				var tbody = ``;
				sentences.forEach(function(sentence){
					console.log(sentence);
					tbody += `<tr id="sen${sentence.pmid}" onClick="test()">
								<td>${sentence.pmid}</td>
								<td>${sentence.sentence}</td>
								<td>${sentence.sentenceOrder}</td>
								<td>${sentence.abstractTextOrder}</td>
							 </tr>`;	
				});
				$('tbody').html(tbody);
			}
			
		})();
		function test(){
			console.log(this);
		}
	</script>
</body>
</html>
